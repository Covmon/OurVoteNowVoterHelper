<!DOCTYPE html>
<html>
<head>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
    <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/fixedcolumns/3.2.6/js/dataTables.fixedColumns.min.js"></script>

   <style type="text/css">

   @import url('https://fonts.googleapis.com/css?family=Oswald|Roboto+Mono:300,400|Roboto|Montserrat:400,700|PT+Serif');
      
    body {
        width: 100vw;
        text-align: center;
        margin: 0px;
        padding: 0px;
        background-color: white;
        font-family: "Roboto";
    }
    
    h1 {
        font-family: "Oswald";
    }

    th, td { white-space: nowrap; }

    th {
        background-color: white;
    }

    .nav {
        background-color: rgb(240,240,240);
        width: 100%;
        border-bottom: 3px solid rgb(15,95,130);
        z-index: 1000;
        margin: 0px;
        padding-bottom: 10px;
        padding-top: 20px;
    }

    .select-container {
        padding-top: 10px;
    }

    .title-container {
        width: 100vw;
        background-color: rgb(220,220,220);
        margin-top: -20px;
        border-bottom: 3px solid rgb(15,95,130);

    }

    .title {
        width: 80vw;
        margin-left: 10vw;
        display: flex;
        justify-content: space-between;
        align-items: center;
        height: 70px;
    }

    #logo {
        display: inline-flex;
        width: 100px;
        height: auto;
    }

    #logo:hover {
        opacity: 0.7;
        transition-duration: 0.3s;
    }

    .nav h1 {
        display: inline-flex;
    }

    .data {
        padding-top: 50px;
        padding-bottom: 50px;
        width: 80vw;
        margin: 0 auto;
    }

    h1 {
        color: rgb(200,67,41);
    }

    .select-style select {
        font-size: 15px;
        cursor: pointer;
        padding: 5px 8px;
        width: 110%;
        border: none;
        box-shadow: none;
        background: transparent;
        background-image: none;
        -webkit-appearance: none;
    }

    .select-style {
        cursor: pointer;
        width: 200px;
        font-family: "Roboto", sans-serif;
        border-radius: 2px;
        padding: 0;
        display: inline-block;
        margin-bottom: 5px;
        margin: 5px;
        background-color: white;
        background: #fff url("icon-select.svg") no-repeat 90% 50%;
        background-size: 10px 20px;
        border-bottom: 3px solid rgb(220, 220, 220);
        transition-duration: 0.2s;
    }

    .select-style:hover {
        border-color: rgb(200,67,41);
        background-color: rgb(240,240,240);
    }

    .select-style-selected {
        border-color: rgb(200,67,41);
        background-color: rgb(240,240,240);
    }

    .select-style select:focus {
        outline: none;
    }

    .button {
        width: 200px;
        display: inline-block;
        background-color: white;
        border-radius: 1px;
        font-size: 15px;
        padding: 8px 16px;
        margin: 15px 5px;
        -webkit-transition-duration: 0.2s; /*for safari*/
        transition-duration: 0.2s;
        cursor: pointer;
        font-weight: bold;
    }
    
    .disabled {
        color: black;
        border: 2px solid rgb(220, 220, 220);
        cursor: not-allowed;
    }

    .disabled:hover {
        background-color: rgb(220, 220, 220);
    }

    .enabled {
        color: rgb(200,67,41);
        border: 2px solid rgb(200,67,41);
        cursor: pointer;
    }

    .enabled:hover {
        color: #fff;
        background-color: rgb(200,67,41);
    }

    .footer {
        padding-top: 25px;
        padding-bottom: 25px;
        width: 100vw;
        background-color: rgb(240,240,240);
        color: rgb(160,160,160);
    }

    .region {
        display: 'none';
    }   
   
    div.dataTables_wrapper {
        width: 80vw;
        margin: 0 auto;
    }

    #scroll-for-more {
        float: right;
        color: gray;
    }

   </style>

</head>

<body> 

    <div class='nav'>
        <div class='title-container'>
            <div class='title'>
                <a href="http://ourvotenow.org"><img id="logo" src="ourvotenowlogo.jpeg" /></a>
                <h1>OVN Election Stats Tool</h1>
            </div>
        </div>
        <br />
        <div class='select-container'>
        <b>Choose which data to display:</b>
        <br />
            Show me
            <div class="x-axis select-style">
                <select name="x-axis" id="x-axis">
                    <option value="" disabled selected>Choose X-Axis</option>
                    <option id="age" value="age">Age</option>
                    <option id="gender" value="gender">Gender</option>  
                    <option id="race" value="race">Race</option>
                    <option id="statewide" value="statewide">Statewide</option>
                    <option id="congressional-district" value="congressional-district">Congressional District</option>
                    <option id="county" value="county">County</option>  
                    <option id="precinct" value="precinct">Precinct</option>
                </select>  
            </div>
            vs.
            <div class="y-axis select-style">
                <select name="y-axis" id="y-axis">
                    <option value="" disabled selected>Choose Y-Axis</option>
                    <option id="age" value="age">Age</option>
                    <option id="gender" value="gender">Gender</option>  
                    <option id="race" value="race">Race</option>
                    <option id="statewide" value="statewide">Statewide</option>
                    <option id="congressional-district" value="congressional-district">Congressional District</option>
                    <option id="county" value="county">County</option>  
                    <option id="precinct" value="precinct">Precinct</option>
                </select>  
            </div>
            <br/>
            <br />
            for the 
            <div class='date election-type select-style'>
                <select name="election-type" id="election-type">
                    <option value="" disabled selected>Choose Election Type</option>
                    <option id="presidential-primary" value="presidential-primary">Presidential Primary</option>
                    <option id="primary" value="primary">Primary</option>  
                    <option id="primary-runoff" value="primary-runoff">Primary Runoff</option>
                    <option id="general" value="general">General</option>
                </select>  
            </div>
            Election during
            <div class='date election-year select-style'>
                <select name="election-year" id="election-year">
                    <option value="" disabled selected>Choose Year</option>
                    <option value="2010">2010</option>
                    <option value="2012">2012</option>
                    <option value="2014">2014</option>  
                    <option value="2016">2016</option>
                    <option value="2018">2018</option>
                </select> 
            
            </div>
            <br/>
            <br />
            <br />
            <b>Choose one region, or don't select any for statewide data:</b>
            <br />
            County:
            <div class='county-select select-style'>
                <select name="county-select" id="county-select">
                    <option id="county-first" value="" disabled selected>Choose County</option>
                    <option id="county-NA" value="N/A">N/A</option>
                </select>  
            </div>
            Congressional District:
            <div class='congressional-district-select select-style'>
                <select name="congressional-district-select" id="congressional-district-select">
                    <option id="congressional-district-first" value="" disabled selected>Choose District</option>
                    <option id="congressional-district-NA" value="N/A">N/A</option>
                </select>  
            </div>
            Precinct:
            <div class='precinct-select select-style'>
                <select name="precinct-select" id="precinct-select">
                    <option value="" disabled selected>Choose Precinct</option>
                    <option value="Statewide">Statewide</option>
                    <option value="CongressionalDistrict">Congressional District</option>
                    <option value="County">County</option>  
                    <option value="Precinct">Precinct</option>
                    <option value="N/A">N/A</option>
                </select>  
            </div>
        </div>
        <br/>
        <div class="button disabled" id="go-button">Go</div>
    </div>
    
    <div class="data">
    </div>

    <div class='footer'>
    <p>&copy 2018 OurVoteNow. Made by Sam Mahle and Noah Covey.</p>
    </div>



 <script type="text/javascript">

    setupButtonEvents();

    var responses = {"x-axis": "", "y-axis": "", "election-type": "", "election-year": "", "region": "statewide", "county": "", "congressional-district": "", "precinct": ""};
    var x_selected = false;
    var y_selected = false;
    var type_selected = false;
    var year_selected = false;

    let ga_counties = ["Appling","Atkinson","Bacon","Baker","Baldwin","Banks","Bartow","Ben Hill","Berrien","Bibb","Bleckley","Brantley","Brooks","Bryan","Bulloch","Burke","Calhoun","Camden","Candler","Carroll","Catoosa","Charlton","Chatham","Chattahoochee","Chattooga","Cherokee","Clarke","Clay","Clayton","Clinch",
    "Cobb","Coffee","Colquitt","Columbia","Cook","Coweta","Crawford","Crisp","Dade","Dawson","DeKalb","Decatur","Dodge","Dooly","Dougherty","Douglas","Early","Echols","Effingham","Elbert","Emanuel","Evans","Fannin","Fayette","Floyd","Forsyth","Franklin","Fulton","Gilmer","Glascock","Glynn","Gordon","Grady","Greene",
    "Gwinnett","Habersham","Hall","Hancock","Haralson","Harris","Hart","Heard","Henry","Houston","Irwin","Jackson","Jasper","Jeff Davis","Jefferson","Jenkins","Johnson","Jones","Lamar","Lanier","Laurens","Lee","Liberty","Lincoln","Long","Lowndes","Lumpkin","Macon","Madison","Marion","McDuffie","McIntosh","Meriwether",
    "Miller","Mitchell","Monroe","Montgomery","Morgan","Murray","Muscogee","Newton","Oconee","Oglethorpe","Paulding","Peach","Pickens","Pierce","Pike","Polk","Pulaski","Putnam","Quitman","Rabun","Randolph","Richmond","Rockdale","Schley","Screven","Seminole","Spalding","Stephens","Stewart","Sumter","Talbot","Taliaferro",
    "Tattnall","Taylor","Telfair","Terrell","Thomas","Tift","Toombs","Towns","Treutlen","Troup","Turner","Twiggs","Union","Upson","Walker","Walton","Ware","Warren","Washington","Wayne","Webster","Wheeler","White","Whitfield","Wilcox","Wilkes","Wilkinson","Worth"];

    for (var i=0;i<ga_counties.length;i++) {
        let countyName = ga_counties[i];
        let newOption = "<option value='" + countyName + "'>" + countyName + "</option>";
        $("#county-NA").before(newOption);
    }

    $("select").change(function() {
        var value = $(this).val();
        var selectID = $(this).attr("id");  
        console.log(value);
        console.log(selectID);
        if (value != "") {
            
            if (selectID == "x-axis") {
                $(".x-axis").addClass("select-style-selected");
                $(".y-axis").find("#" + value).prop("disabled", true);
                if (x_selected) {
                    $(".y-axis").find("#" + responses["x-axis"]).prop("disabled", false);
                }
                x_selected = true;

            } else if (selectID == "y-axis") { 
                $(".y-axis").addClass("select-style-selected");
                $(".x-axis").find("#" + value).prop("disabled", true);
                if (y_selected) {
                    $(".x-axis").find("#" + responses["y-axis"]).prop("disabled", false);
                }
                y_selected = true;

            } else if (selectID == "election-type") {
                $(".election-type").addClass("select-style-selected");
                type_selected = true;

            } else if (selectID == "election-year") {
                $(".election-year").addClass("select-style-selected");
                year_selected = true;

            } else if (selectID == "county-select") {
                $(".county-select").addClass("select-style-selected");
                responses["region"] = "county"; 

            } else if (selectID == "congressional-district-select") {
                $(".congressional-district-select").addClass("select-style-selected");
                responses["region"] = "congressional-district";

            } else if (selectID == "precinct-select") {
                $(".precinct-select").addClass("select-style-selected");
                responses["region"] = "precinct";

            }

            responses[selectID] = $(this).val();
            console.log(responses);
        } 

        if (x_selected && y_selected && type_selected && year_selected) {
            console.log("Ready to hit go");
            $("#go-button").addClass("enabled").removeClass("disabled");
        }

    });
        

    function setupButtonEvents() {
        var buttons = document.getElementsByClassName("button");
        for (i = 0; i < buttons.length; i++) {
            buttons[i].addEventListener("click", function() {
                clickButton(this.id)
            });
        }
    }

    function clickButton(id) {

        var buttonClicked = document.getElementById(id);

    }

    function isEitherSelected(string, x_axis, y_axis) {
        if (x_axis == string || y_axis == string) {
            return true;
        } else {
            return false;
        }
    }

    function areBothSelected(string1, string2, x_axis, y_axis) {
        if ((x_axis == string1 && y_axis == string2) || (x_axis == string2 && y_axis == string1)) {
            return true;
        } else {
            return false;
        }
    }

    function displayTableURL() {

        console.log("Get Table CSV URL!");
        console.log(responses);
        var URL = "";

        let x_axis = responses["x-axis"];
        let y_axis = responses["y-axis"];
        let regionLevel = responses["region"];
        let year = responses["election-year"];
        let type = responses["election-type"];
        let county = responses["county"];
        let congressional_district = responses["congressional-district"];
        let precinct = responses["precinct"];

        switch (type) {
            case "general":
                type = "General";
                break;
            case "primary":
                type = "Primary";
                break;
            default:
                break;
        }

        if (regionLevel == "statewide") {
            if (areBothSelected("gender", "race", x_axis, y_axis)) {
                URL = year + "/" + type + "/Congressional/Congressional_percent_voted.csv" 
            } else if (isSelected("gender", x_axis, y_axis)) {
                URL = year + "/" + type + "/Congressional/Congressional_percent_voted_gender.csv" 
            } else if (isSelected("race", x_axis, y_axis)) {
                URL = year + "/" + type + "/Congressional/Congressional_percent_voted_race.csv"
            }

        } else if (regionLevel == "county") {

        } else if (regionLevel == "congressional-district") {

        } else if (regionLevel == "precinct") {

        }

    return URL

    }

    $(document).ready(function(){
        $('#go-button').click(function(){

            if ($(this).hasClass("disabled")) {
                return false;
            }

            console.log("Clicked an enabled go button");

            var table_url = "https://www.noahcovey.com/OurVoteNowVoterHelper/Georgia_Election_Data_CSVs/" + displayTableURL();
            console.log(table_url);

            $.ajax({
                url:table_url,
                dataType:"text",
                success:function(data)
                {
                    console.log("successfully got csv!");
                    //console.log(data);
                    var employee_data = data.split(/\r?\n|\r/);
                    var table_data = '<p id="scroll-for-more">Scroll for more &#x25B8;</p><br/><table id="data-table" class="display nowrap" style="width:100%"><thead>';
                    for(var count = 0; count<employee_data.length - 1; count++)
                    {
                        var cell_data = employee_data[count].split(",");
                        table_data += '<tr>';
                        for(var cell_count=0; cell_count < cell_data.length; cell_count++)
                        {
                            var dontAddTR = false;
                            if(count == 0)
                            {
                              table_data += '<th>' + cell_data[cell_count] + '</th>';

                                if (cell_count == cell_data.length - 1) {
                                    dontAddTR = true;
                                    table_data += '</tr></thead><tbody>';
                                }
                            }
                            else
                            {
                                table_data += '<td>' + cell_data[cell_count] + '</td>';
                            }

                            
                        }
                        if (!dontAddTR) {
                            table_data += '</tr>';
                        }
                    }
                    table_data += '</tbody></table>';

                    $('.data').html(table_data);
                                        
                    $('.data').html(table_data);
                    $("#data-table").DataTable({
                        scrollX: true,
                        paging: false,
                        searching: false,
                        ordering: false,
                        fixedColumns: true
                    });
                }
            });
        });

    });

</script>

</body>
</html> 