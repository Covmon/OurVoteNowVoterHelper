<html>

<head>
	<style type="text/css">

		body {
			background-color: rgb(50,50,50);
		}

		p {
			padding: 10px;
			padding-bottom: 0px;
			color: black;
		}

		h2 {
			margin-top: 20px;
			color: black;
		}

		.wrapper {
			text-align: center;
		}

		.hidden {
			display: none;
		}
		
		.collapsible {
			margin-bottom: 2px;
			margin-top: 2px;
			background-color: #ee3233;
			border-radius: 2px;
			cursor: pointer;
			outline: none;
			width: 50vw;
			text-align: center;
			font-size: 15px;
			color: white;
			border: none;
			transition-duration: 0.1s;
			padding: 5px;
		}

		.active, .collapsible:hover {
			background-color: #ba2526;
		}

		.active:hover {
			background-color: #9e1f20;
		}

		.collapsible:after {
			content:'\002b'; /*Plus sign*/
			font-size: 13px;
			font-weight: bold;
			color: white;
			float: right;
		}

		.active:after {
			content: "\2212"; /*Minus sign*/
		}

		.answered:after {
			content: "\2705"; /*Check mark*/
		}

		.locked:after {
			content: "\1F512" /*Locked Sign*/
		}

		.content {
  			width: 50vw;
  			max-height: 0;
  			overflow: hidden;
  			transition: max-height 0.4s ease-out;
  			background-color: rgb(230, 230, 230);
  			/*
  			display: flex;
 			justify-content: center;*/
 			border-radius: 2px;
 			margin: 0 auto;
		}

		.button {
			font-size: 15px;
			background-color: white;
			border-radius: 1px;
			color: #ee3233;
			border: 2px solid #ee3233;
			padding: 8px 16px;
			-webkit-transition-duration: 0.4s; /*for safari*/
			transition-duration: 0.4s;
			cursor: pointer;
			margin: 15px 5px;
		}

		.button:hover {
			color: #fff;
			background-color: #ee3233;
		}

		.button-active {
			color: #fff;
			background-color: #ee3233;
		}

		.button-active:hover {
			color: #fff;
			border-color: #9e1f20;
			background-color: #9e1f20;
		}

		.button-deselected:hover {
			color: #ee3233;
			background-color: #fff;
			border-color: #ee3233;
		}

		.input-text {
			border: none;
			border-bottom: 3px solid gray;
			transition-duration: 0.4s;
			border-radius: 2px;
			outline: 0 none;
			font-size: 15px;
			margin: 15px 5px;
			margin-bottom: 0px;
			padding: 8px 16px;
		}

		.input-text:hover {
			border-bottom: 3px solid #222;
		}

		.input-text:focus {
			border-color: #ee3233;
			background-color: white;
		}

		select {
			font-size: 25px;
			/*outline: 0 none;*/
		}

		select:focus {
			/*border: 3px solid #ee3233;*/
		}


	</style>


</head>

<body>

	<h1 style="color:white; text-align: center; margin: 20px;">Our Vote Now Voter Helper Tool</h1>

	<!--Category: "registered"-->
	<div class="wrapper" id="registered">
		<button class = "collapsible initial" id="coll-registered">Are You Registered?</button>
		<div class="content">
			<button class="button 1" id="registered-yes" category="registered" value="yes">Yes</button>
			<button class="button 1" id="registered-maybe" category="registered" value="maybe">I'm not sure</button>
			<button class="button 1" id="registered-no" category="registered" value="no">No</button>
		</div>
	</div>

	<!--Category: "age"-->
	<div class="wrapper hidden" id="age">
		<button class = "collapsible locked" id="coll-age">What's your age?</button>
		<div class="content">

			<button class="button 2" id="age-younger" category="age" value="younger">Younger than 17 1/2</button>
			<button class="button 2" id="age-older" category="age" value="older">Older than 17 1/2</button>
		</div>
	</div>

	<!--Category: "address"-->
	<div class="wrapper" id="address">
		<button class = "collapsible locked" id="coll-address">Where's your residence address?</button>
		<div class="content">

			<input class="input-text" type="text" name="street" value="" id="street" placeholder="Street">
			<input class="input-text" type="text" name="city" value="" id="city" placeholder="City">
			<select class="select" name="state" id="state">
				<option value="" disabled selected>State</option>
				<option value="GA">GA</option>
				<option value="FL">FL</option>
				<option value="other">Other</option>
			</select>
			<input class="input-text" type="text" name="zip" id="zip" value="" placeholder="Zip">

			<button class="button 3" id="address-submit" category="address" value="submit">Continue</button>
			
		</div>
	</div>

	<!--Category: "votetype"-->
	<div class="wrapper" id="votetype">
		<button class = "collapsible locked" id="coll-votetype">How do you want to vote?</button>
		<div class="content">
			<button class="button 5" id="votetype-early" category="votetype" value="early">Early</button>
			<button class="button 5" id="votetype-absentee" category="votetype" value="absentee">Absentee</button>
			<button class="button 5" id="votetype-regular" category="votetype" value="regular">Regular</button>
		</div>
	</div>

	<!--Your personalized instructions appear here-->
	<div class="wrapper" id="instructions">
		<button class="collapsible locked" id="coll-instructions">Your next steps...</button>
		<div class="content">
			<h2 id="instructions-title">Thanks for using the OurVoteNow voter helper tool.</h1>
			<p id="instructions-text">Here are those instructions</p>

			<a href="#" id="instructions-link" target="_self">
				<button class="button 4" id="instructions-button" category="instructions" value="link">Go</button>
			</a>

		</div>
	</div>


	<script type="text/javascript">

		var currentSelections = ["1-0", "2-0"];
		var responses = {"registered": "", "age": "", "address": "", "votetype": ""};

		setupButtonEvents();
		setupCollapsibles();


		
		//Add collapse and expand events to all collapsibles
		function setupCollapsibles() {
			var coll = document.getElementsByClassName("collapsible");
			var i;

			for (i = 0; i < coll.length; i++) {
		  		coll[i].addEventListener("click", function() {
		  			toggleCollapsable(this)
		  		});
			}

			/*Start with the first collapsable open*/
			var init = document.getElementsByClassName("initial");
			var j;

			for (i=0;i<init.length; i++) {
				toggleCollapsable(init[i]);
			}
		}

		function toggleCollapsable(collapse) {
			if (collapse.classList.contains("locked")) { //This row is locked, don't open it up
				return;
			} else {
				collapse.classList.toggle("active");
			    var content = collapse.nextElementSibling;
			    if (content.style.maxHeight){
			      content.style.maxHeight = null;
			    } else {
			      content.style.maxHeight = content.scrollHeight + 100 + "px";
			    } 
			}
		}

		//Add click button events to all buttons
		function setupButtonEvents() {
			var buttons = document.getElementsByClassName("button");
			for (i = 0; i < buttons.length; i++) {
		  		buttons[i].addEventListener("click", function() {
		  			clickButton(this.id)
		  		});
			}
		}

		function clickButton(id) {

			//var classClicked = document.getElementsByClassName(classs);
			var buttonClicked = document.getElementById(id);
			var buttonValue = buttonClicked.value;
			var buttonCategory = buttonClicked.getAttribute("category");
			var collapsibleID = "coll-" + buttonCategory;
			var collapsibleSection = document.getElementById(collapsibleID);
			//classClicked.classList.add("answered");

			console.log("Button clicked of category: " + buttonCategory + ", value: " + buttonValue);

			if (buttonValue == responses[buttonCategory]) { //we clicked a select button that's already active
				buttonClicked.classList.remove("button-active");
				collapsibleSection.classList.remove("answered");


				responses[buttonCategory] = "";

			} else if (buttonValue == "submit" || buttonValue == "link") { //this is a submit button

				submitRow(buttonCategory);
				collapsibleSection.classList.add("answered");

			} else { //this is a select button that's not already active
				if (responses[buttonCategory] != "") { //Is there already another button in this category selected?

					var otherID = "" + buttonCategory + "-" + responses[buttonCategory]; //eg "age" + "younger" = "age-younger"
					console.log("other id " + otherID);
					document.getElementById(otherID).classList.remove("button-active");
				}

				responses[buttonCategory] = buttonValue;
				buttonClicked.classList.add("button-active");
				collapsibleSection.classList.add("answered");



				submitRow(buttonCategory);

			}
		}

		function submitRow(buttonCategory) {
			switch(buttonCategory) {
				case "registered":
					submitRegistered();
					break;
				case "age":
					submitAge();
					break;
				case "address":
					submitAddress();
					break;
				case "votetype":
					submitVoteType();
					break;
			}
		}

		function submitRegistered() {
			var registeredValue = responses["registered"];
			var nextSection;
			var nextCollapsible;

			var currentCollapsible = document.getElementById("coll-registered");
			toggleCollapsable(currentCollapsible);

			if (registeredValue == "yes") {

				nextSection = document.getElementById("address");

				nextCollapsible = document.getElementById("coll-address");
				nextCollapsible.classList.remove("locked");
				toggleCollapsable(nextCollapsible);

			} else if (registeredValue == "maybe" || registeredValue == "no") {

				nextSection = document.getElementById("age");
				nextSection.classList.remove("hidden");

				nextCollapsible = document.getElementById("coll-age");
				nextCollapsible.classList.remove("locked");
				toggleCollapsable(nextCollapsible);
			} else {

				console.log("ERROR: registered value not valid");

			}


		}

		function submitAge() {
			var ageValue = responses["age"];
			var nextSection;
			var nextCollapsible;

			var currentCollapsible = document.getElementById("coll-age");
			toggleCollapsable(currentCollapsible);

			if (ageValue == "younger") {

				displayInstructionsTooYoung();
				toggleInstructionsPanel(nextSection, nextCollapsible);
				
			} else if (ageValue == "older") {

				//Check whether they are registered or are unsure
				var registered = responses["registered"];

				if (registered == "maybe") {

					displayInstructionsCheckRegistration();
					toggleInstructionsPanel(nextSection, nextCollapsible);

				} else if (registered == "no") {

					displayInstructionsRegister();
					toggleInstructionsPanel(nextSection, nextCollapsible);

				} else if (registered == "yes") {
					console.log("ERROR: how did we get here?");
				}

			} else {
				console.log("ERROR: age value not valid");
			}

		}

		function submitAddress() {
			var street = document.getElementById("street").value;
			var city = document.getElementById("city").value;
			var state = document.getElementById("state").value;
			var zip = document.getElementById("zip").value;

			var address = "" + street + " " + city + " " + state + " " + zip;
			console.log(address);

			responses["address"] = address;

			var nextSection = document.getElementById("votetype");
			var nextCollapsible = document.getElementById("coll-votetype");
			nextCollapsible.classList.remove("locked");

			var currentCollapsible = document.getElementById("coll-address");

			nextSection.classList.remove("hidden");

			toggleCollapsable(currentCollapsible);
			toggleCollapsable(nextCollapsible);
		}

		function submitVoteType() {
			var votetypeValue = responses["votetype"];

			var nextSection;
			var nextCollapsible;

			var currentCollapsible = document.getElementById("coll-votetype");
			toggleCollapsable(currentCollapsible);

			if (votetypeValue == "early") {

				displayInstructionsEarlyVoting();
				toggleInstructionsPanel(nextSection, nextCollapsible);

			} else if (votetypeValue == "absentee") {

				displayInstructionsAbsenteeVoting();
				toggleInstructionsPanel(nextSection, nextCollapsible);

			} else if (votetypeValue == "regular") {

				displayInstructionsRegularVoting();
				toggleInstructionsPanel(nextSection, nextCollapsible);

			} else {
				console.log("ERROR: votetype value not valid");
			}
		}

		function toggleInstructionsPanel(nextSection, nextCollapsible) {
			nextSection = document.getElementById("instructions");
			nextSection.classList.remove("hidden");

			nextCollapsible = document.getElementById("coll-instructions");
			nextCollapsible.classList.remove("locked");
			toggleCollapsable(nextCollapsible);
		}

		function displayInstructionsTooYoung() {
			var title = document.getElementById("instructions-title");
			var text = document.getElementById("instructions-text");
			var button = document.getElementById("instructions-button");
			var link = document.getElementById("instructions-link");

			link.setAttribute("href", "http://www.ourvotenow.org/join.html");
			link.setAttribute("target", "_blank");
			button.innerHTML = "Get Involved";

			title.innerHTML = "Just wait a few months!";
			text.innerHTML = "Right now, you're too young to register to vote. But as soon as you turn 17 1/2, be sure to register. In the meantime, you can get involved with our organization here:";

		}

		function displayInstructionsCheckRegistration() {
			var title = document.getElementById("instructions-title");
			var text = document.getElementById("instructions-text");
			var button = document.getElementById("instructions-button");
			var link = document.getElementById("instructions-link");

			link.setAttribute("href", "https://www.rockthevote.org/voting-information/am-i-registered-to-vote/");
			link.setAttribute("target", "_blank");
			button.innerHTML = "Check registration status";

			title.innerHTML = "Check your voter registration";
			text.innerHTML = "You're old enough to register, but you're not sure if you are. Use this button to check whether or not you're registered to vote:";
		}

		function displayInstructionsRegister() {
			var title = document.getElementById("instructions-title");
			var text = document.getElementById("instructions-text");
			var button = document.getElementById("instructions-button");
			var link = document.getElementById("instructions-link");

			link.setAttribute("href", "http://www.ourvotenow.org/register-to-vote.html");
			link.setAttribute("target", "_blank");
			button.innerHTML = "Register to vote!";

			title.innerHTML = "Register to vote";
			text.innerHTML = "Good news! You're set to register. Use this button to get started registering:";
		}

		function displayInstructionsEarlyVoting() {
			var title = document.getElementById("instructions-title");
			var text = document.getElementById("instructions-text");
			var button = document.getElementById("instructions-button");
			var link = document.getElementById("instructions-link");

			link.setAttribute("href", "https://www.mvp.sos.ga.gov/MVP/mvp.do");
			link.setAttribute("target", "_blank");
			button.innerHTML = "How to vote early";

			title.innerHTML = "Early voting";
			text.innerHTML = "Awesome! The General Election takes place November 6th, but you can vote early from XX/XX until XX/XX. Use this link to find your early voting location:";
		}

		function displayInstructionsAbsenteeVoting() {
			var title = document.getElementById("instructions-title");
			var text = document.getElementById("instructions-text");
			var button = document.getElementById("instructions-button");
			var link = document.getElementById("instructions-link");

			link.setAttribute("href", "http://sos.ga.gov/index.php/Elections/absentee_voting_in_georgia");
			link.setAttribute("target", "_blank");
			button.innerHTML = "Get your absentee ballot";

			title.innerHTML = "Absentee voting";
			text.innerHTML = "Awesome! The General Election takes place November 6th, but you can vote absentee from XX/XX until XX/XX. Use this link to learn how to request an absentee ballot:";
		}

		function displayInstructionsRegularVoting() {
			var title = document.getElementById("instructions-title");
			var text = document.getElementById("instructions-text");
			var button = document.getElementById("instructions-button");
			var link = document.getElementById("instructions-link");

			link.setAttribute("href", "https://www.mvp.sos.ga.gov/MVP/mvp.do");
			link.setAttribute("target", "_blank");
			button.innerHTML = "How to vote on election day";

			let query = voterInfoQuery();
			let election = query.election.name;
			let date = query.election.electionDay;

			title.innerHTML = "Regular voting";
			text.innerHTML = "You can vote in the " + election + " on " + date + ". Use this link to learn where to go to vote:";


		}

		function voterInfoQuery(address) {
			//var url = "https://www.googleapis.com/civicinfo/v2/elections?key=AIzaSyAhC1y0Vc09spgiF1KYdUJwag71TGitZgc";
			var url = "https://www.googleapis.com/civicinfo/v2/voterinfo?address=4839-Adams-Walk-Dunwoody-GA-30338&key=AIzaSyAhC1y0Vc09spgiF1KYdUJwag71TGitZgc&electionId=6000";

			var xmlHttp = new XMLHttpRequest();
		    xmlHttp.open( "GET", url, false ); // false for synchronous request
		    xmlHttp.send( null );
		    var responseText = xmlHttp.responseText;
		    var responseObject = JSON.parse(responseText);


		    console.log("Here is the response object from the Google Voter Info Query:");
		    console.log(responseObject);

		    return responseObject;

		}

	</script>

</body>
</html>